---
title: 浏览器事件循环
published: 2025-10-30
draft: false
tags: [浏览器]
toc: true
description: 浏览器事件循环详解。
---

## 进程/线程

进程：程序运行所占用的内存空间  
线程：进程的运行单元

每个进程启动时都会创建一个线程（主线程）

浏览器会启动多个进程：浏览器主进程、网络进程、渲染进程、GPU进程、插件进程等

:::note
谷歌浏览器查看 进程：右上角菜单 -> 更多工具 -> 任务管理器
:::

事件循环执行在渲染进程的渲染主线程中

## 事件循环

- 渲染主线程从任务队列中取一个宏任务执行
- 清空微队列任务，如果期间产生新的微任务也会被清空
- 判断是否需要渲染页面，requestAnimationFrame会在这个阶段执行
- 进入下一个循环，如果所有任务队列为空渲染主线程就进入休眠，直至下一个任务到来唤醒渲染主线程

## 任务队列

- 宏任务会有多个任务队列：
  - 延时队列（优先级中）：setTimeout、setInterval、setImmediate
  - 交互队列（优先级高）：I/O、UI交互事件
  - ......(还有很多其他的队列)
- 微任务只有一个微队列（优先级最高）：Promise、MutationObserver、queueMicrotask、async函数中的await之后代码

:::tip

W3C定义：

- 每个任务都有类型，同一个类型的任务必须在一个队列，不同类型的任务可以分属不同队列。  
  在一次事件循环中，浏览器根据实际情况从不同队列中获取任务执行。
- 浏览器必须准备好一个微队列，微队列中的任务优先执行

:::
